#!/usr/bin/python3
import requests
import json
import time

# input file contain hash
inpFile = '../result/pe_hash_00416.md5'
outpFile = "../result/vtv3_sample_00416.json"

with open(inpFile, "r") as f:
    for line in f:
        begin_idx = line.find("'sha256': ") + 11
        sha256 = line[begin_idx:begin_idx + 64]
        # print(sha256)
        # search on virustotal
        url = "https://www.virustotal.com/api/v3/files/" + sha256
        headers = {
            "Accept": "application/json",
            "x-apikey": "<your virustotal apiv3 api>"
        }
        response = requests.get(url, headers=headers)
        # time.sleep(15)
        if(response.status_code == 200): # success
            # writen file
            wfile = open(outpFile, "a")
            for line in response.text.split('\n'):
                wfile.write(line.replace(" ", ""))
            wfile.write('\n')
            wfile.close()
        else: # failure case
            f = open("../result/vtv3_sample_00416_fail.txt", "a")
            f.write(sha256)
            f.write('\n')
            f.close()
