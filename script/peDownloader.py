#!/usr/bin/python3
from virusshare import VirusShare
import time
from os import listdir
from os.path import isfile, join

# read hashfile
print("Available hashfiles:")
hash_files = [f for f in listdir('../hashfiles/') if isfile(join('../hashfiles/', f))]
for file in hash_files:
    print("- " + file)
print("_________________________________________")
print("With format: VirusShare_X.md5\nEnter X:  ") 
X = input().strip()

# you need provide api here
v = VirusShare('<api>')

# read hash file
hashList = []
with open(f"../hashfiles/VirusShare_{X}.md5", "r") as f:
    for line in f:
        hashList.append(line.strip())
# pop header file
hashList = hashList[6:]
for hash in hashList:
    res = v.info(hash)
    filetype = res['data']['filetype']
    if('PE' in filetype):
        if('DLL' not in filetype):
            f = open(f'../result/pe_hash_{X}.md5', 'a')
            f.write(str(res))
            f.write('\n')
            f.close()
            # download file and storage location
            v.download(hash, '../result/files')
    time.sleep(35)
