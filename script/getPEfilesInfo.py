#!/usr/bin/python3
from virusshare import VirusShare
import time
import os
from os.path import isfile, join

v = VirusShare('<your_api_key>')

# read hashfile
print("Available hashfiles:")
hash_files = [f for f in os.listdir('../hashfiles/') if isfile(join('../hashfiles/', f))]
for file in hash_files:
    print("- " + file)
print("_________________________________________")
print("With format: VirusShare_X.md5\nEnter X:  ") 
X = input().strip()
# delete previous file for re-run
if os.path.exists(f'../result/pe_hash_{X}.md5'):
    os.remove(f'../result/pe_hash_{X}.md5')
# get each pe file info & save into '../result/pe_info_X.md5'
with open(f"../hashfiles/VirusShare_{X}.md5", "r") as f:
    for line in f:
        if('#' in line):
            continue
        res = v.info(line.strip())
        time.sleep(15)
        filetype = res['data']['filetype']
        if('PE' in filetype):
            if('DLL' not in filetype):
                print(line)
                fout = open(f'../result/pe_hash_{X}.md5', 'a')
                fout.write(str(res) + '\n')
                fout.close()
